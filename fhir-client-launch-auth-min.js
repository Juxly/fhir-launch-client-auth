!function(){function e(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e,t,n,r){try{var o={name:"SMART on FHIR Testing Server",description:"Dev server for SMART on FHIR",url:n,oauth2:{registration_uri:null,authorize_uri:null,token_uri:null}};(r=JSON.parse(r)).rest[0].security.extension.filter(function(e){return"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris"===e.url})[0].extension.forEach(function(e,t,n){"register"===e.url?o.oauth2.registration_uri=e.valueUri:"authorize"===e.url?o.oauth2.authorize_uri=e.valueUri:"token"===e.url&&(o.oauth2.token_uri=e.valueUri)}),t&&t(o)}catch(t){return e&&e(t)}}function n(e,n,r){var i=new XMLHttpRequest;i.open("GET",o(e)+"/metadata"),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4===i.readyState&&200===i.status?t(r,n,e,i.responseText):r(i.responseText)},i.send()}function r(e){for(var t=location.search.substr(1).split("&"),n=[],r=0;r<t.length;r++){var o=t[r].split("=");if(o[0]===e){var i=o[1].replace(/\+/g,"%20");n.push(decodeURIComponent(i))}}if(n.length)return n[0]}function o(e){return"/"===e.substr(-1)?e.substr(0,e.length-1):e}function i(e){return(window.location.protocol+"//"+window.location.host+window.location.pathname).match(/(.*\/)[^/]*/)[1]+(e||"")}doAuthorize=function(t,o){o||(o=function(){console.log("Failed to discover authorization URL given",t)}),delete sessionStorage.tokenResponse,t.client||(t={client:t}),t.response_type=t.response_type||"code",t.client.redirect_uri=t.client.redirect_uri||i(),t.client.redirect_uri.match(/:\/\//)||(t.client.redirect_uri=i(t.client.redirect_uri)),t.client.redirect_uri.match(/:\/\//)||(t.client.redirect_uri=i(t.client.redirect_uri));var c=r("launch");c&&(t.client.scope.match(/launch/)||(t.client.scope+=" launch"),t.client.launch=c);var u=r("iss")||r("fhirServiceUrl");u&&!t.server&&(t.server=u),n(t.server,function(n){t.provider=n;var r=t.client.state||e(),o=t.client;sessionStorage[r]=JSON.stringify(t);var i=t.provider.oauth2.authorize_uri+"?client_id="+encodeURIComponent(o.client_id)+"&response_type="+encodeURIComponent(t.response_type)+"&scope="+encodeURIComponent(o.scope)+"&redirect_uri="+encodeURIComponent(o.redirect_uri)+"&state="+encodeURIComponent(r)+"&aud="+encodeURIComponent(t.server);void 0!==o.launch&&o.launch&&(i+="&launch="+encodeURIComponent(o.launch)),window.location.href=i},o)}}();